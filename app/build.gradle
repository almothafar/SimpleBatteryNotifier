plugins {
    id 'com.android.application'
}

// Load version from properties file
def versionPropsFile = file('../version.properties')
def versionProps = new Properties()

if (versionPropsFile.exists()) {
    versionProps.load(new FileInputStream(versionPropsFile))
} else {
    // Fallback defaults if file doesn't exist
    versionProps['versionCode'] = '70'
    versionProps['versionPrefix'] = '2.0'
}

// Auto-increment version code on release builds
task('incrementVersion') {
    doLast {
        def currentCode = versionProps['versionCode'].toInteger()
        versionProps['versionCode'] = (currentCode + 1).toString()
        versionProps.store(versionPropsFile.newWriter(), "Auto-incremented by build")
        println("Version incremented to ${versionProps['versionCode']}")
    }
}

// Hook into assembleRelease to auto-increment
tasks.whenTaskAdded { task ->
    if (task.name == 'assembleRelease') {
        task.dependsOn 'incrementVersion'
    }
}

android {
    namespace 'com.almothafar.simplebatterynotifier'

    compileSdk = 36

    defaultConfig {
        applicationId "com.almothafar.simplebatterynotifier"
        minSdk = 26
        targetSdk = 36
        versionCode versionProps['versionCode'].toInteger()
        versionName "${versionProps['versionPrefix']}.${versionProps['versionCode']}"
    }

    buildTypes {
        release {
            minifyEnabled true
            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'),
                    'proguard-rules.pro'
        }
        debug {
//            applicationIdSuffix ".debug"
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_25
        targetCompatibility JavaVersion.VERSION_25
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])

    implementation 'androidx.appcompat:appcompat:1.7.1'
    implementation 'androidx.core:core:1.17.0'
    implementation 'com.google.android.material:material:1.13.0'

    implementation 'androidx.preference:preference:1.2.1'     // AndroidX settings UI
    implementation 'androidx.activity:activity:1.12.1'        // Activity Result API (for ringtone picker)
    implementation 'androidx.cardview:cardview:1.0.0'         // CardView for battery insights

    // Add more AndroidX as you update imports (e.g., constraintlayout)
    // implementation 'androidx.constraintlayout:constraintlayout:2.1.4'
}
